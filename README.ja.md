# YT Outline & Snap

YouTube Watchページ上にオーバーレイ表示し、Gemini APIを使った要約生成と動画スナップショット撮影を行うChrome拡張機能です。

## 機能

- **要約生成**: Gemini 2.5 Pro APIを使用して動画のトランスクリプトと画面内のコンテンツを分析
- **スナップショット撮影**: 現在のフレームや特定のタイムスタンプでのスクリーンショットを取得
- **アウトライン表示**: 重要ポイントをタイムスタンプ順に詳細な解説付きで表示
- **一括撮影**: アウトラインの全タイムスタンプを自動的に撮影
- **エクスポート機能**: スナップショットと説明文をマークダウン形式でZIPファイルにエクスポート
- **ブラウザ完結**: サーバーレスで完全にブラウザ内で動作

## インストール

### 必要条件

- Chrome 117+ または Edge 117+（WebCodecs対応が必須）
- [Google AI Studio](https://ai.google.dev/)から取得したGemini APIキー

### インストール手順

1. 拡張機能のZIPファイルをダウンロードして解凍
2. ChromeまたはEdgeで`chrome://extensions/`にアクセス
3. 右上の「デベロッパーモード」を有効化
4. 「パッケージ化されていない拡張機能を読み込む」をクリックし、解凍した`dist`フォルダを選択
5. 拡張機能のアイコンをクリックして「オプション」からGemini APIキーを設定

## 使い方

1. **APIキーの設定**: 拡張機能のアイコンをクリックして「オプション」からGemini APIキーを設定
2. **要約の生成**: YouTube動画ページでオーバーレイの「要約を生成」ボタンをクリック
3. **スナップショット撮影**: 「スナップショット」ボタンをクリックして現在のフレームを撮影
4. **タイムスタンプでの撮影**: アウトラインの各項目横のカメラアイコンをクリックして特定のタイムスタンプで撮影
5. **一括撮影**: 「全て撮影」をクリックしてアウトラインの全タイムスタンプを自動的に撮影
6. **エクスポート**: 「Export All Snapshots」ボタンをクリックして、スナップショット画像とマークダウン形式の説明文をZIPファイルとしてエクスポート。エクスポートされるZIPファイルには以下が含まれます：
   - マークダウン形式のドキュメント（動画ID、エクスポート日時、アウトライン情報、各スナップショットの詳細情報を含む）
   - `imgs_[videoId]`フォルダ内に整理されたスナップショット画像

## 技術詳細

### アーキテクチャ

- **Manifest V3** とservice workerバックグラウンドスクリプト
- **React 18 + TypeScript 5 + Tailwind 3 + shadcn/ui** によるUI
- **WebCodecs** による高性能スナップショット撮影（Canvasフォールバック付き）
- **XState** による状態管理

### UI/UX機能

- **オーバーレイパネル**: 折りたたみ可能なレスポンシブデザイン
- **編集ボタン**: #008299のソリッドカラーで目立つデザイン
- **全削除機能**: スナップショットとアウトラインを一括削除する機能
- **エクスポート機能**: スナップショットとアウトライン情報をマークダウン形式でエクスポート

### フェイルセーフ機能

- **DOM変化対応**: MutationObserver + レイアウト調整関数
- **DRM検出**: 保護されたコンテンツに対してスナップショット機能を自動的に無効化
- **メモリ管理**: 高解像度動画に対応した最適化されたメモリ使用
- **WebCodecsフォールバック**: WebCodecsが利用できない場合にCanvasへ優雅に切り替え

### 制限事項

- **DRMコンテンツ**: DRM保護された動画ではスナップショット機能が無効
- **高解像度**: 非常に高解像度の動画（4K/8K）ではパフォーマンスの問題が発生する可能性あり
- **API制限**: Gemini APIのレート制限とクォータに依存

### ローカルストレージ保存

高品質なスナップショット（最大1080p）を保存するため、unlimitedStorage権限を使用しています。
この拡張機能は、ユーザーのローカルストレージにのみデータを保存し、外部サーバーには送信しません。
ストレージ使用量はいつでも確認でき、不要なデータは簡単に削除できます。

## 開発

### プロジェクト構造

```
/extension
 ├─ /public
 │   └─ _locales/  // 多言語リソース
 │       ├─ en/
 │       └─ ja/
 ├─ /src
 │   ├─ /components  // Reactコンポーネント
 │   ├─ /lib         // コア機能
 │   ├─ /machines    // XState状態マシン
 │   ├─ background.ts
 │   ├─ contentScript.tsx
 │   ├─ options.tsx
 │   └─ manifest.json
 └─ vite.config.ts
```

### ソースからのビルド

1. 依存関係のインストール: `npm install`
2. 拡張機能のビルド: `npm run build`
3. `dist`フォルダをパッケージ化されていない拡張機能として読み込み

## ライセンス

MIT License

## 謝辞

- [shadcn/ui](https://ui.shadcn.com/) - UIコンポーネント
- [XState](https://xstate.js.org/) - 状態管理
- [Vite](https://vitejs.dev/) - ビルドツール
